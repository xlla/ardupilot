# hw definition file for processing by chibios_hwdef.py
# for F411RE bootloader

# MCU class and specific type
MCU STM32F4xx STM32F411xE


define CONFIG_HAL_BOARD_SUBTYPE HAL_BOARD_SUBTYPE_CHIBIOS_GENERIC

define HAL_MINIMIZE_FEATURES 1

# crystal frequency
OSCILLATOR_HZ 8000000

#define STM32_PLLSRC                        STM32_PLLSRC_HSE
define STM32_PLLM_VALUE 8
#cpu mhz
define STM32_PLLN_VALUE 200   
define STM32_PLLP_VALUE 2
define STM32_PLLQ_VALUE 2



# now we need to specify the APJ_BOARD_ID. This is the ID that the
# bootloader presents to GCS software so it knows if this firmware is
# suitable for the board. Please see
# https://github.com/ArduPilot/Bootloader/blob/master/hw_config.h for
# a list of current board IDs. If you add a new board type then please
# get it added to that repository so we don't get conflicts.

# Note that APJ is "ArduPilot JSON Firmware Format"
# board ID for firmware load
APJ_BOARD_ID 139

# the nucleo seems to have trouble with flashing the last sector?
FLASH_SIZE_KB 1024

#FLASH_RESERVE_START_KB 128

# board voltage
STM32_VDD 330U

# this is the STM32 timer that ChibiOS will use for the low level
# driver. This must be a 32 bit timer. We currently only support
# timers 2, 3, 4, 5 and 21. See hal_st_lld.c in ChibiOS for details

# ChibiOS system timer
STM32_ST_USE_TIMER 5

#usart 6 usb otg
#PA11 USB_FS_DM OTG1
#PA12 USB_FS_DP OTG1

# these are the pins for SWD debugging with a STlinkv2 or black-magic probe
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# the normal usage of this ordering is:
# 1) SERIAL0: console (primary mavlink, usually USB)
# 2) SERIAL3: primary GPS
# 3) SERIAL1: telem1
# 4) SERIAL2: telem2
# 5) SERIAL4: GPS2
# 6) SERIAL5: extra UART (usually RTOS debug console)

# use UART for stdout, so no STDOUT_SERIAL
#STDOUT_SERIAL SD5
#STDOUT_BAUDRATE 57600

# this is the pin that senses USB being connected. It is an input pin
# setup as OPENDRAIN
#PA9 VBUS INPUT OPENDRAIN

# order of UARTs (and USB)
UART_ORDER USART6 USART2 USART1

# UART1 for serial 3 gps
PA9 USART1_TX USART1
PA10 USART1_RX USART1

# USART2 serial2 telem1
PA2 USART2_TX USART2 
PA3 USART2_RX USART2

# USART6 
PA11 USART6_TX USART6 
PA12 USART6_RX USART6


define HAL_USE_EMPTY_STORAGE 1
define HAL_STORAGE_SIZE 16384

#define HAL_SPI_CHECK_CLOCK_FREQ

PC9 LED1 OUTPUT LOW
PC8 LED2 OUTPUT LOW

define HAL_USE_ADC FALSE

# SPI1
#PA5 SPI1_SCK SPI1
#PA6 SPI1_MISO SPI1
#PA7 SPI1_MOSI SPI1


define HAL_COMPASS_DEFAULT HAL_COMPASS_NONE
define HAL_INS_DEFAULT HAL_INS_NONE
define HAL_BARO_DEFAULT HAL_BARO_NONE
